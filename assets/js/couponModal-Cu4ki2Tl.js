import{C as a}from"./cartState-Dk7kX525.js";class i{constructor(){this.modal=null,this.isOpen=!1,this.init()}init(){this.createModal(),this.bindEvents()}async createModal(){try{const e=await fetch("/Eastleigh-Turf-Grass-Clean/partials/coupon-modal.html");if(!e.ok)throw new Error("Failed to load coupon modal template");const t=await e.text();document.body.insertAdjacentHTML("beforeend",t),this.modal=document.getElementById("couponModal")}catch(e){console.error("Error loading coupon modal:",e)}}bindEvents(){document.addEventListener("click",e=>{if(this.modal&&((e.target.id==="closeCouponModal"||e.target.closest(".modal-overlay")||e.target.id==="cancelCouponBtn")&&this.close(),e.target.id==="applyCouponBtn"&&this.applyCoupon(),e.target.classList.contains("code-suggestion"))){const t=this.modal.querySelector("#couponCodeInput");t.value=e.target.textContent,t.focus()}}),document.addEventListener("keydown",e=>{if(e.key==="Enter"&&this.isOpen){const t=this.modal.querySelector("#couponCodeInput");document.activeElement===t&&this.applyCoupon()}e.key==="Escape"&&this.isOpen&&this.close()})}open(){this.modal&&(this.modal.classList.add("active"),this.isOpen=!0,document.body.style.overflow="hidden",setTimeout(()=>{const e=this.modal.querySelector("#couponCodeInput");e&&e.focus()},100),this.clearMessage())}close(){if(!this.modal)return;this.modal.classList.remove("active"),this.isOpen=!1,document.body.style.overflow="";const e=this.modal.querySelector("#couponCodeInput");e&&(e.value=""),this.clearMessage()}applyCoupon(){if(!this.modal)return;const t=this.modal.querySelector("#couponCodeInput").value.trim().toUpperCase();if(!t){this.showMessage("Please enter a coupon code","error");return}const o=this.modal.querySelector("#applyCouponBtn"),n=o.textContent;o.textContent="Applying...",o.disabled=!0;const s=a.applyCoupon(t);o.textContent=n,o.disabled=!1,s.valid?(this.showMessage(s.message,"success"),setTimeout(()=>{this.close()},2e3)):this.showMessage(s.message,"error")}showMessage(e,t="info"){const o=this.modal.querySelector("#couponMessage");o&&(o.className=`coupon-message ${t}`,o.textContent=e,o.style.display="block")}clearMessage(){const e=this.modal.querySelector("#couponMessage");e&&(e.style.display="none",e.textContent="")}isModalOpen(){return this.isOpen}}const c=new i;export{c as couponModal};
